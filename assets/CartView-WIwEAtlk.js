import{H as v}from"./HeaderComponent-ovXlqhDB.js";import{L as x}from"./LoadingComponent-bRK5ChZG.js";import{_ as k,e as p,f as c,j as r,u as d,m as t,F as g,k as V,i as m,t as l,s as h}from"./index-Ooy_6cGs.js";const w={components:{HeaderComponent:v,LoadingComponent:x},data(){return{isLoading:!1,carts:[],total:0,finalTotal:0,code:"",isChange:!1}},inject:["toast","removeAlert"],methods:{async getCarts(){this.isLoading=!0,await this.axios.get("https://vue3-course-api.hexschool.io//v2/api/rongapi/cart").then(s=>{s.data.success?(this.finalTotal=s.data.data.final_total,this.total=s.data.data.total,this.carts=s.data.data.carts):this.toast("error","尚未抓到資料"),this.isLoading=!1}).catch(s=>{this.toast("error","尚未抓到資料"),console.error("cart-getCarts error",s),this.isLoading=!1})},couponSubmit(){this.axios.post("https://vue3-course-api.hexschool.io//v2/api/rongapi/coupon",{data:{code:this.code}}).then(s=>{s.data.success?(this.toast("success","已更新商品價格"),this.getCarts()):this.toast("error","輸入錯誤")}).catch(s=>{this.toast("error","輸入錯誤"),console.error("cart-couponSubmit error",s)})},removeCart(i){const s=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${i}`;this.removeAlert().then(u=>{u.isConfirmed&&this.axios.delete(s).then(a=>{a.data.success?(this.getCarts(),this.isChangeCarts()):this.toast("error","失敗，請重新操作")}).catch(a=>{this.toast("error","失敗，請重新操作"),console.error("cart-removeCart error",a)})})},async count(i,s,u){let a=s;if(u===!0?a++:a--,a>10||a<=0)return;const o=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${i}`;await this.axios.put(o,{data:{product_id:i,qty:a}}).then(n=>{n.data.success?(this.getCarts(),this.isChangeCarts()):this.toast("error","失敗，請重新操作")}).catch(n=>{this.toast("error","失敗，請重新操作"),console.error("cart-removeCart error",n)})},isChangeCarts(){this.isChange===!1?this.isChange=!0:this.isChange=!1},goPay(){localStorage.setItem("carts",this.carts),localStorage.setItem("finalTotal",this.finalTotal),localStorage.setItem("total",this.total),this.$router.push({name:"pay"})}},created(){this.getCarts()}},L={key:0,class:"has-header-layout"},T={class:"container py-40 py-lg-80"},q=t("h2",{class:"pb-3 fw-bold"},"購物車",-1),S={class:"row"},j={class:"col-12 col-lg-8"},F={class:"row g-0 bg-info"},N={class:"col-2"},H=["src","alt"],U={class:"col-5 align-content-center"},B={class:"card-body"},I={class:"card-title"},P=t("p",{class:"fs-7"},"尺寸：F",-1),A={class:"col-3 align-content-center"},M={class:"d-flex justify-content-between max-width-120"},D=["disabled","onClick"],E=t("span",{class:"material-symbols-outlined fs-5"}," remove ",-1),z=[E],G=["disabled","onClick"],J=t("span",{class:"material-symbols-outlined fs-5"}," add",-1),K=[J],O={class:"col-2 align-content-center text-end"},Q=["onClick"],R={class:"d-inline-block"},W={class:"d-flex align-items-center bg-info"},X=t("button",{type:"submit",class:"btn btn-primary"},"套用",-1),Y=t("p",{class:"p-0 pt-2"},"首購族五折：first5off",-1),Z={class:"col-12 col-lg-4"},$={class:"pt-5 pt-lg-0 text-end"},tt={class:"d-flex justify-content-between"},st=t("span",null,"商品小計",-1),et={class:"d-flex justify-content-between"},ot=t("span",null,"折扣小計",-1),at=t("hr",null,null,-1),nt={class:"d-flex justify-content-between"},it=t("span",null,"訂單金額",-1),lt={class:"text-dark"},ct={key:1,class:"has-header-layout d-flex justify-content-center align-items-center text-center"},rt=t("p",null,[h(" 您尚未選購商品"),t("br"),h(" 現在首購可有5折優惠"),t("br"),h("趕快去購買吧~~~ "),t("br"),t("br"),h(" 首購族優惠碼：first5off ")],-1),dt=[rt];function ht(i,s,u,a,o,n){const b=p("HeaderComponent"),C=p("LoadingComponent"),f=p("VField"),y=p("VForm");return c(),r(g,null,[d(b,{isChange:o.isChange},null,8,["isChange"]),d(C,{isLoading:o.isLoading},null,8,["isLoading"]),o.carts.length>=1?(c(),r("main",L,[t("section",T,[q,t("div",S,[t("div",j,[(c(!0),r(g,null,V(o.carts,e=>(c(),r("div",{class:"card align-items-center mb-3 p-0",key:e.id},[t("div",F,[t("div",N,[t("img",{src:e.product.imageUrl,width:"320",height:"320",class:"img-fluid object-fit-cover h-100",alt:e.id},null,8,H)]),t("div",U,[t("div",B,[t("h6",I,l(e.product.title),1),P,t("span",null,"NT$ "+l(e.product.price),1)])]),t("div",A,[t("div",M,[t("button",{type:"button",class:"d-flex bg-transparent d-flex p-0 border-0",disabled:e.qty<=1,onClick:_=>n.count(e.id,e.qty,!1)},z,8,D),d(f,{name:"number",type:"number",class:"fs-5",modelValue:e.qty,"onUpdate:modelValue":_=>e.qty=_,rules:"required",ref_for:!0,ref:"count"},{default:m(()=>[h(l(e.qty),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("button",{type:"button",class:"d-flex bg-transparent d-flex p-0 border-0",disabled:e.qty>=10,onClick:_=>n.count(e.id,e.qty,!0)},K,8,G)])]),t("div",O,[t("button",{type:"button",class:"btn-close mx-20","aria-label":"Close",onClick:_=>n.removeCart(e.id)},null,8,Q)])])]))),128)),d(y,{onSubmit:n.couponSubmit},{default:m(()=>[t("div",R,[t("div",W,[d(f,{type:"text",name:"coupon",class:"form-control w-auto border-0 bg-transparent",placeholder:"請輸入折價卷碼","aria-label":"請輸入折價卷碼",modelValue:o.code,"onUpdate:modelValue":s[0]||(s[0]=e=>o.code=e)},null,8,["modelValue"]),X])])]),_:1},8,["onSubmit"]),Y]),t("div",Z,[t("div",$,[t("p",tt,[st,t("span",null,l(o.total),1)]),t("p",et,[ot,t("span",null,l(o.finalTotal===o.total?"-0":Math.round(o.finalTotal-o.total)),1)]),at,t("div",nt,[it,t("h5",lt," NT$ "+l(o.finalTotal===o.total?o.total:Math.round(o.finalTotal)),1)]),t("button",{type:"button",class:"btn btn-primary mt-3",onClick:s[1]||(s[1]=(...e)=>n.goPay&&n.goPay(...e))}," 下一步 ")])])])])])):(c(),r("main",ct,dt))],64)}const ft=k(w,[["render",ht]]);export{ft as default};
